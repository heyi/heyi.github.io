<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link rel="stylesheet" href="/css/core.css" media="screen" />
  <title>叶子绿的天空</title>
</head>

<body>

  <div class="wrapper">
    <div id="sidebar">
      <p>一个靠谱的前端,一个追求梦想的北漂...</p>
      <div id="search">
        <input type="text" id="search-query" name="q" placeholder="站内搜索" autocomplete="off">
      </div>

      <section id="search-results" style="display: none;">
      <div class="entries"> </div>
      </section>

      <h3>最新文章</h3>
      <hr/>
      <ul>
        <ul style='list-style:none;margin:0px;padding:0px;'>
          
          <li>
          <a href="/webapp/experience/2014/08/06/index.html">实现无缝Carousel</a>
          </li>
          
          <li>
          <a href="/port/2014/07/03/index.html">医院微站接口数据</a>
          </li>
          
          <li>
          <a href="/webapp/experience/2014/07/02/index.html">访名医官网开发教程</a>
          </li>
          
          <li>
          <a href="/webapp/experience/2014/07/01/index.html">移动开发个人总结</a>
          </li>
          
        </ul>
      </ul>

    </div>
    <div id="content">
      <article>
  <h1>访名医官网开发教程</h1>
  <div class="info">
    <span class='tag-label'>标签: </span>
    <ul class="tag-list">
      
      <li>
        tutorials
      </li>
      
    </ul>
  </div>
	<hr/>
	<p>本文是<a href="http://fangmingyi.com/#/">访名医</a>官网的开发基本教程,为后续团队协作文档参考..</p>

<h2 id="">环境搭建</h2>

<ul>
<li>osx 10.8 以上</li>

<li>安装node</li>

<li>安装<a href="http://yeoman.io/">yeoman</a>
<ul>
<li>yo (脚手架工具)</li>

<li>grunt (构建工具）</li>

<li>bower (包管理工具)</li>
</ul>
</li>
</ul>

<h2 id="_2">建立项目与目录结构说明</h2>

<p>终端输入 yo，按引导一步步建立项目。 目录如图所示： <img src="/images/angular.png" alt="angular demo" /></p>

<ul>
<li>app 项目主体
<ul>
<li>bower_components 引用的类库</li>

<li>images 图片存放目录</li>

<li>index.html 程式入口文件</li>

<li>scripts 脚本目录</li>

<li>styles 样式文件目录</li>

<li>views 界面文件目录</li>
</ul>
</li>

<li>node_modules node 模块包</li>

<li>test 测试文件包</li>

<li>.editorconfig 编辑器配置文件</li>

<li>.gitignore git 提交时会忽略的文件与目录</li>

<li>.jshintrc 部署时jshint 检测js文件时的配置</li>

<li>.travis.yml 开发环境配置文件</li>

<li>.bowerrc bower配置文件</li>

<li>karma.conf.js karma 配置信息（测试专用,目前得得比较少)</li>

<li><em>Gruntfile.js</em> 部署配置脚本</li>

<li><em>bower.json</em> bower 包管理器配置说明</li>

<li><em>package.json</em> npm 包管理器配置说明</li>
</ul>

<h2 id="_3">引用的类库</h2>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
 <span class='s2'>&quot;name&quot;</span><span class='o'>:</span> <span class='s2'>&quot;fmy-app&quot;</span><span class='p'>,</span>
  <span class='s2'>&quot;version&quot;</span><span class='o'>:</span> <span class='s2'>&quot;0.0.1&quot;</span><span class='p'>,</span>
  <span class='s2'>&quot;dependencies&quot;</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='s2'>&quot;angular&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;json3&quot;</span><span class='o'>:</span> <span class='s2'>&quot;~3.2.6&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;es5-shim&quot;</span><span class='o'>:</span> <span class='s2'>&quot;~2.1.0&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-resource&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-cookies&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-sanitize&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-animate&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-touch&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-route&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;devDependencies&quot;</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='s2'>&quot;angular-mocks&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span><span class='p'>,</span>
    <span class='s2'>&quot;angular-scenario&quot;</span><span class='o'>:</span> <span class='s2'>&quot;1.2.15&quot;</span>
  <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p><em>其中</em> ：</p>

<ul>
<li>angular-resource 与后台接口接处用到的类库</li>

<li>angular-animate 支持动画</li>

<li>angular-route 路由管理</li>

<li>angular-touch 支持touch,swipe 等事件 其它可以关注<a href="https://docs.angularjs.org/api/ngSanitize/service/$sanitize">官方文档</a>.</li>
</ul>

<h2 id="_4">构建引用的类库说明</h2>

<p>构建引用的类库不少，其中可以重点关注的是:</p>

<ul>
<li>grunt-contrib-imagemin 负责图片的压缩与转换</li>

<li>grunt-usemin 负责脚本的压缩与合并</li>
</ul>
<div class='highlight'><pre><code class='html'>  <span class='c'>&lt;!--[if lte IE 9]&gt;</span>
<span class='c'>   &lt;!--build:css({.tmp,app}) styles/ie8.css --&gt;</span>
   <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;styles/ie8.css&quot;</span><span class='nt'>&gt;</span> 
   <span class='c'>&lt;!--endbuild --&gt;</span>
  <span class='cp'>&lt;![endif]--&gt;</span>
</code></pre></div>
<ul>
<li>grunt-bower-install 自动插入引用的库与相关依赖脚本</li>
</ul>
<div class='highlight'><pre><code class='html'>  <span class='c'>&lt;!-- build:js scripts/vendor.js --&gt;</span>
  <span class='c'>&lt;!-- bower:js --&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular/angular.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular-resource/angular-resource.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular-cookies/angular-cookies.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular-sanitize/angular-sanitize.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular-animate/angular-animate.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular-touch/angular-touch.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;bower_components/angular-route/angular-route.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='c'>&lt;!-- endbower --&gt;</span>
  <span class='c'>&lt;!-- endbuild --&gt;</span>
</code></pre></div>
<ul>
<li>time-grunt 显示单个构建任务的耗时</li>
</ul>

<p>其它详细的情况可参阅官方说明与Gruntfile.js</p>

<h2 id="_5">解耦策略与分层</h2>

<p>想了好久，还是<a href="http://zh.wikipedia.org/wiki/AngularJS">维基</a>上的总结得最好;</p>

<h3 id="angular">Angular的哲学</h3>

<blockquote>
<p>AngularJS是建立在这样的信念上的：即声明式编程应该用于构建用户界面以及编写软件构建， 而指令式编程非常适合来表示业务逻辑。 框架采用并扩展了传统HTML，通过双向的数据绑定来适应动态内容，双向的数据绑定允许模型和视图 之间的自动同步。因此，AngularJS使得对DOM的操作不再重要并提升了可测试性。</p>
</blockquote>

<blockquote>
<p>设计目标：</p>
</blockquote>

<blockquote>
<ul>
<li>将应用逻辑与对DOM的操作解耦。这会提高代码的可测试性。</li>

<li>将应用程序的测试看的跟应用程序的编写一样重要。代码的构成方式对测试的难度有巨大的影响。</li>

<li>将应用程序的客户端与服务器端解耦。这允许客户端和服务器端的开发可以齐头并进，并且让双方的复用成为可能。</li>

<li>指导开发者完成构建应用程序的整个历程: 从用户界面的设计，到编写业务逻辑，再到测试。</li>
</ul>
</blockquote>

<blockquote>
<p>Angular遵循软件工程的MVC模式,并鼓励展现，数据，和逻辑组件之间的松耦合.通过依赖注入（dependency injection），Angular为客户端的Web应用带来了传统服务端的服务，例如独立于视图的控制。 因此，后端减少了许多负担，产生了更轻的Web应用。</p>
</blockquote>

<p>实际开发过程中,建议先熟悉官方的文档，参考最佳开发经验 重点推荐的资料主要有： <a href="https://github.com/angular/angular.js/wiki">angular维基文档</a> <a href="https://github.com/angular/angular.js/wiki">官方文档</a></p>

<p>开发成员需要编写视图文件 <em>views/</em>.html* , 相应的控制器 <em>scripts/controllers.js</em> ，与数据交互服务程序 <em>scripts/services.js</em> 。视业务需要还需要编写自定义指令 <em>scripts/directive.js</em> 。</p>

<p>几个小技巧可以显著提高开发效率;</p>

<ol>
<li>需求弄清楚了才动手设计.</li>

<li>响应式设计与响应式开发可以维护更少的版本与代码.</li>

<li>用sass可以更快，更清晰的组织样式.</li>

<li>用自定义指令编写共用的组件.</li>
</ol>

<p>举个小粟子,响应式设计中往往要更多的考虑图片的问题，pc 可以用较大的图片，而移动端图片就需要裁剪以降低大小并突出重点。所以，设计一般会出二个图，一个是pc端的，一个是移动端。</p>

<p>所以前端需要判断是否是移动端，从而引用不同的图片并延迟加载. 一个误区是媒介查询不能精确反应是否是手机端，所以需要自己编写相应的指令。</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>app</span><span class='p'>.</span><span class='nx'>directive</span><span class='p'>(</span><span class='s1'>&#39;responseImage&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>fmyApi</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='k'>return</span> <span class='p'>{</span>
    <span class='nx'>restrict</span><span class='o'>:</span> <span class='s1'>&#39;A&#39;</span><span class='p'>,</span>
    <span class='nx'>scope</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='nx'>phoneImg</span><span class='o'>:</span> <span class='s1'>&#39;&lt;a href=&#39;</span><span class='nx'>https</span><span class='o'>:</span><span class='c1'>//github.com/phoneImg&#39; class=&#39;user-mention&#39;&gt;@phoneImg&lt;/a&gt;&#39;,</span>
      <span class='nx'>pcImg</span><span class='o'>:</span> <span class='s1'>&#39;&lt;a href=&#39;</span><span class='nx'>https</span><span class='o'>:</span><span class='c1'>//github.com/pcImg&#39; class=&#39;user-mention&#39;&gt;@pcImg&lt;/a&gt;&#39;,</span>
    <span class='p'>},</span>
    <span class='nx'>link</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>$scope</span><span class='p'>,</span> <span class='nx'>element</span><span class='p'>,</span> <span class='nx'>attrs</span><span class='p'>)</span> <span class='p'>{</span>
      <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nx'>fmyApi</span><span class='p'>.</span><span class='nx'>isPhone</span> <span class='o'>&amp;&amp;</span> <span class='nx'>$scope</span><span class='p'>.</span><span class='nx'>pcImg</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='kd'>var</span> <span class='nx'>img</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s2'>&quot;img&quot;</span><span class='p'>);</span>
        <span class='nx'>img</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='nx'>$scope</span><span class='p'>.</span><span class='nx'>pcImg</span><span class='p'>;</span>
        <span class='nx'>img</span><span class='p'>.</span><span class='nx'>onload</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
          <span class='nx'>element</span><span class='p'>.</span><span class='nx'>append</span><span class='p'>(</span><span class='nx'>img</span><span class='p'>);</span>
        <span class='p'>};</span>
      <span class='p'>}</span>
      <span class='k'>if</span> <span class='p'>(</span><span class='nx'>fmyApi</span><span class='p'>.</span><span class='nx'>isPhone</span> <span class='o'>&amp;&amp;</span> <span class='nx'>$scope</span><span class='p'>.</span><span class='nx'>phoneImg</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='kd'>var</span> <span class='nx'>img</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s2'>&quot;img&quot;</span><span class='p'>);</span>
        <span class='nx'>img</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='nx'>$scope</span><span class='p'>.</span><span class='nx'>phoneImg</span><span class='p'>;</span>
        <span class='nx'>img</span><span class='p'>.</span><span class='nx'>onload</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
          <span class='nx'>element</span><span class='p'>.</span><span class='nx'>append</span><span class='p'>(</span><span class='nx'>img</span><span class='p'>);</span>
        <span class='p'>};</span>
      <span class='p'>}</span>
    <span class='p'>}</span>
  <span class='p'>};</span>
<span class='p'>});</span>
</code></pre></div>
<p>services.js 通常是处理后台交互的程序以及一些公用函数。 <img src="/images/service.png" alt="services.js" /> 使用就比较简单了：</p>

<pre class="xml"><code class="xml">
&lt;div class=&#39;&#39; response-image pc-img=&#39;images/law.png&#39;&gt;&lt;/div&gt;
</code></pre>

<p>更多的资料可以参考我写的开发总结, <a href="http://heyi.github.io/webapp/experience/2014/07/01/index.html">开发中遇到的坑与总结</a></p>

<h2 id="_6">项目的发布</h2>

<p>默认的发布目录是dist 实际开发过程中，多个项目可能会共享一个repository. 比如访名医官网与公益活动，这时候需要为不同的项目编写不 同的gruntfile 脚本，并指定不同的发布地址。</p>

<p>我探索得出的经验是： 多个项目可以共享node_modules ,package.json , 但最好不同的项目设置不同的程序主体目录，同时为了构建方便，最好不要共享bower_components. 为了发布方便，我编写了一个部署的shell脚本：</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>function</span> <span class='n'>help</span> <span class='p'>()</span> <span class='p'>{</span>
    <span class='n'>echo</span> <span class='s2'>&quot;It is  a simple script that makes using the grunt to developing our project &quot;</span>
    <span class='n'>echo</span> <span class='s2'>&quot;&quot;</span>
    <span class='n'>echo</span> <span class='s2'>&quot;./install.sh app                                  --部署官网 &quot;</span><span class='p'>;</span>
    <span class='n'>echo</span> <span class='s2'>&quot;./install.sh app-charity                          --部署公益活动&quot;</span><span class='p'>;</span>
    <span class='n'>echo</span> <span class='s2'>&quot;./install.sh all                                  --一起部署&quot;</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='n'>function</span> <span class='n'>deploy_app</span> <span class='p'>()</span> <span class='p'>{</span>
    <span class='n'>sed</span> <span class='o'>-</span><span class='n'>ig</span> <span class='s1'>&#39;s/app-charity/app/g&#39;</span> <span class='o'>.</span><span class='n'>bowerrc</span><span class='p'>;</span>
    <span class='n'>git</span> <span class='n'>pull</span>  <span class='n'>origin</span> <span class='n'>master</span> <span class='o'>&amp;&amp;</span> <span class='n'>grunt</span> <span class='n'>build</span> <span class='o'>-</span><span class='n'>f</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='n'>function</span> <span class='n'>deplay_app_charity</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='n'>sed</span> <span class='o'>-</span><span class='n'>ig</span> <span class='s1'>&#39;s/app\//app-charity\//g&#39;</span> <span class='o'>.</span><span class='n'>bowerrc</span><span class='p'>;</span>
    <span class='n'>git</span> <span class='n'>pull</span> <span class='n'>origin</span> <span class='n'>master</span> <span class='o'>&amp;&amp;</span> <span class='n'>grunt</span> <span class='n'>build</span> <span class='o'>-</span><span class='n'>f</span> <span class='o'>--</span><span class='n'>gruntfile</span> <span class='no'>Gruntfile</span><span class='o'>-</span><span class='n'>charity</span><span class='o'>.</span><span class='n'>js</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='k'>if</span> <span class='o'>[</span> <span class='vg'>$1</span> <span class='o'>]</span>
<span class='k'>then</span>
  <span class='k'>if</span> <span class='o'>[[</span> <span class='vg'>$1</span> <span class='o'>==</span> <span class='s1'>&#39;app&#39;</span> <span class='o'>]]</span><span class='p'>;</span> <span class='k'>then</span>
    <span class='n'>deploy_app</span><span class='p'>;</span>
  <span class='n'>fi</span>

  <span class='k'>if</span> <span class='o'>[[</span> <span class='vg'>$1</span> <span class='o'>==</span> <span class='s1'>&#39;app-charity&#39;</span> <span class='o'>]]</span><span class='p'>;</span> <span class='k'>then</span>
    <span class='n'>deplay_app_charity</span><span class='p'>;</span>
  <span class='n'>fi</span>

  <span class='k'>if</span> <span class='o'>[[</span> <span class='vg'>$1</span> <span class='o'>==</span> <span class='s1'>&#39;all&#39;</span> <span class='o'>]]</span><span class='p'>;</span> <span class='k'>then</span>
    <span class='n'>deploy_app</span><span class='p'>;</span>
    <span class='n'>deplay_app_charity</span><span class='p'>;</span>
  <span class='n'>fi</span>
<span class='k'>else</span>
  <span class='n'>help</span><span class='p'>;</span>
<span class='n'>fi</span>
</code></pre></div>
	<a href="http://heyi.github.io">返回首页</a>
	<span class='fr'>
		02 July 2014
	</span>
  <!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/webapp/experience/2014/07/02/index" data-title="访名医官网开发教程" data-url="/webapp/experience/2014/07/02/index.html"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
    var duoshuoQuery = {
      short_name: "heyi"
    };
    (function()
    {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';
      ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
  <!-- 多说公共JS代码 end -->
</article>

    </div>
  </div>

  <div class='footer'>
    <p>Projects by <a href="https://github.com/heyi">heyi</a> can be found on <a href="https://github.com/heyi">GitHub</a>
    </p>
  </div>
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  
  <script id="search-results-template" type="text/mustache">
    {{#entries}}
    <article>
    <h3>
      <a href="{{url}}">{{title}}</a>
      {{#date}}<small><time datetime="{{pubdate}}" pubdate>{{displaydate}}</time></small>{{/date}}
    </h3>
    </article>
    {{/entries}}
  </script>
  
  <script type="text/javascript">
    $(function() { $('#search-query').lunrSearch({ indexUrl: '/search.json', results:  '#search-results', entries:  '.entries',      template: '#search-results-template' }); });
  </script>
</body>
</html>